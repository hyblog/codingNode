'use strict';

const { inspect } = require('util');
const isObject = require('celia/isObject');
const formatDate = require('celia.date/format');

/**
 * 转换成文本日志格式
 * @param {Object} options 配置参数
 */
module.exports = function (options = {}) {
  const { datePattern = 'YYYY-MM-DD HH:mm:ss.SSS Z', depth = Infinity } = options;
  return function (args, {
    logger,
    level,
    timestamp
  }) {
    timestamp = timestamp && datePattern ? `[${formatDate(new Date(timestamp), datePattern)}] ` : '';
    args = args.map(arg => isObject(arg) ? inspect(arg, { depth }) : arg).join(' ');
    return `${timestamp}[${level}] ${logger} - ${args}`;
  };
};
