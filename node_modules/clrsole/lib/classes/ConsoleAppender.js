'use strict';

const chalk = require('chalk');
const { getColor } = require('../util');
const Appender = require('./AbstractAppender');
const basicLayout = require('../layout');

class ConsoleAppender extends Appender {

  /**
   * 构造函数
   * @param {String} name
   * @param {Object} options appender对应的配置
   */
  constructor(name, options) {
    super(name, options);
    this.layout = basicLayout(options);
    this.isPM2Worked = !!process.env.PM2_HOME;
  }

  append(args, options) {
    const { level } = options;
    if (this.isLevelEnabled(level)) {
      if (this.isPM2Worked) {
        options.timestamp = null;
      }
      const data = this.layout(args, options);
      console.log(chalk[getColor(level)](data));
    }
  }

  async destroy() {
    try {
      Object.keys(this).forEach((key) => {
        delete this[key];
      });
    } catch (e) { }
  }

}

module.exports = ConsoleAppender;
